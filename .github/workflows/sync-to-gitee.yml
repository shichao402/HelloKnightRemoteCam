name: Sync Release to Gitee

# ÂΩì GitHub Release ÂàõÂª∫ÂêéÔºåËá™Âä®ÂêåÊ≠•Âà∞ Gitee
on:
  release:
    types: [published]  # ÂΩì Release ÂèëÂ∏ÉÊó∂Ëß¶Âèë
  workflow_call:  # ÂÖÅËÆ∏Ë¢´ÂÖ∂‰ªñÂ∑•‰ΩúÊµÅË∞ÉÁî®
    inputs:
      release_tag:
        description: 'Ë¶ÅÂêåÊ≠•ÁöÑ Release Ê†áÁ≠æÔºà‰æãÂ¶ÇÔºöv1.0.7ÔºâÔºåÁïôÁ©∫Âàô‰ΩøÁî®ÊúÄÊñ∞ Release'
        required: false
        type: string
  workflow_dispatch:  # ÂÖÅËÆ∏ÊâãÂä®Ëß¶Âèë
    inputs:
      release_tag:
        description: 'Ë¶ÅÂêåÊ≠•ÁöÑ Release Ê†áÁ≠æÔºà‰æãÂ¶ÇÔºöv1.0.7ÔºâÔºåÁïôÁ©∫Âàô‰ΩøÁî®ÊúÄÊñ∞ Release'
        required: false
        type: string

jobs:
  sync-release:
    name: Sync Release to Gitee
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Check Gitee Secrets
        env:
          GITEE_REPO_OWNER: ${{ secrets.GITEE_REPO_OWNER }}
          GITEE_REPO_NAME: ${{ secrets.GITEE_REPO_NAME }}
        run: |
          echo "üîç Ê£ÄÊü• Gitee Secrets ÈÖçÁΩÆ..."
          
          # Ê£ÄÊü• GITEE_TOKENÔºà‰∏çÊòæÁ§∫ÊòéÊñáÔºâ
          if [ -z "${{ secrets.GITEE_TOKEN }}" ]; then
            echo "‚ùå GITEE_TOKEN Êú™ÈÖçÁΩÆ"
            exit 1
          else
            TOKEN_LEN=${#GITEE_TOKEN}
            TOKEN_PREFIX="${GITEE_TOKEN:0:4}"
            TOKEN_SUFFIX="${GITEE_TOKEN: -4}"
            echo "‚úÖ GITEE_TOKEN Â∑≤ÈÖçÁΩÆ (ÈïøÂ∫¶: ${TOKEN_LEN}, ÂâçÁºÄ: ${TOKEN_PREFIX}..., ÂêéÁºÄ: ...${TOKEN_SUFFIX})"
          fi
          
          # Ê∏ÖÁêÜÂπ∂ÊòæÁ§∫ GITEE_REPO_OWNERÔºàÊòæÁ§∫ÂÆåÊï¥ÂÄºÔºåÂõ†‰∏∫Ëøô‰∏çÊòØÊïèÊÑü‰ø°ÊÅØÔºâ
          GITEE_REPO_OWNER_CLEAN=$(printf '%s' "${GITEE_REPO_OWNER}" | tr -d '\n\r\t' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
          if [ -z "${GITEE_REPO_OWNER_CLEAN}" ]; then
            echo "‚ùå GITEE_REPO_OWNER Êú™ÈÖçÁΩÆ"
            exit 1
          else
            echo "‚úÖ GITEE_REPO_OWNER Â∑≤ÈÖçÁΩÆ: ${GITEE_REPO_OWNER_CLEAN}"
          fi
          
          # Ê∏ÖÁêÜÂπ∂ÊòæÁ§∫ GITEE_REPO_NAMEÔºàÊòæÁ§∫ÂÆåÊï¥ÂÄºÔºåÂõ†‰∏∫Ëøô‰∏çÊòØÊïèÊÑü‰ø°ÊÅØÔºâ
          GITEE_REPO_NAME_CLEAN=$(printf '%s' "${GITEE_REPO_NAME}" | tr -d '\n\r\t' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
          if [ -z "${GITEE_REPO_NAME_CLEAN}" ]; then
            echo "‚ùå GITEE_REPO_NAME Êú™ÈÖçÁΩÆ"
            exit 1
          else
            echo "‚úÖ GITEE_REPO_NAME Â∑≤ÈÖçÁΩÆ: ${GITEE_REPO_NAME_CLEAN}"
          fi
          
          GITEE_REPO="${GITEE_REPO_OWNER_CLEAN}/${GITEE_REPO_NAME_CLEAN}"
          echo "üì¶ Gitee ‰ªìÂ∫ì: ${GITEE_REPO}"
          echo "‚úÖ ÊâÄÊúâ Gitee Secrets ÈÖçÁΩÆÊ£ÄÊü•ÈÄöËøá"

      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ÈúÄË¶ÅÂÆåÊï¥ÂéÜÂè≤ËÆ∞ÂΩï‰ª•Êé®ÈÄÅÂà∞ Gitee
          ref: main  # ÂàáÊç¢Âà∞ main ÂàÜÊîØ‰ª•Ëé∑ÂèñÊúÄÊñ∞ÁöÑ update_config_github.json

      - name: Extract version from release
        id: get_version
        run: |
          echo "üîç ÊèêÂèñ Release ÁâàÊú¨‰ø°ÊÅØ..."
          echo "  ‰∫ã‰ª∂Á±ªÂûã: ${{ github.event_name }}"
          echo "  GITHUB_REF: ${GITHUB_REF}"
          
          # Â¶ÇÊûúÊòØ workflow_callÔºàË¢´ÂÖ∂‰ªñÂ∑•‰ΩúÊµÅË∞ÉÁî®ÔºâÔºå‰ΩøÁî®ËæìÂÖ•ÁöÑ release_tag
          if [ "${{ github.event_name }}" == "workflow_call" ]; then
            TAG_NAME="${{ inputs.release_tag }}"
            echo "üìå Â∑•‰ΩúÊµÅË∞ÉÁî®: ‰ΩøÁî®Ê†áÁ≠æ ${TAG_NAME}"
            echo "  [Ë∞ÉËØï] inputs.release_tag ÂÄº: '${{ inputs.release_tag }}'"
            echo "  [Ë∞ÉËØï] TAG_NAME ÂÄº: '${TAG_NAME}'"
          # Â¶ÇÊûúÊòØÊâãÂä®Ëß¶ÂèëÔºå‰ΩøÁî®ËæìÂÖ•ÁöÑ release_tag
          elif [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
            TAG_NAME="${{ github.event.inputs.release_tag }}"
            echo "üìå ÊâãÂä®Ëß¶Âèë: ‰ΩøÁî®Ê†áÁ≠æ ${TAG_NAME:-ÔºàÊú™Êèê‰æõÔºåÂ∞Ü‰ΩøÁî®ÊúÄÊñ∞Ôºâ}"
          else
            # ‰ªé release ‰∫ã‰ª∂Ëé∑Âèñ tag ÂêçÁß∞
            # release ‰∫ã‰ª∂ÁöÑ GITHUB_REF Ê†ºÂºèÂèØËÉΩÊòØ refs/tags/v1.0.0
            TAG_NAME=${GITHUB_REF#refs/tags/}
            echo "  [Ë∞ÉËØï] ‰ªé GITHUB_REF ÊèêÂèñ: ${TAG_NAME}"
            
            # Â¶ÇÊûúÊ≤°Êúâ‰ªé GITHUB_REF Ëé∑ÂèñÂà∞ÔºåÂ∞ùËØï‰ªéÁéØÂ¢ÉÂèòÈáèËé∑Âèñ
            if [ -z "$TAG_NAME" ] || [ "$TAG_NAME" == "$GITHUB_REF" ]; then
              # release ‰∫ã‰ª∂ÂèØËÉΩ‰ΩøÁî®‰∏çÂêåÁöÑ ref
              TAG_NAME=${GITHUB_REF#refs/heads/}
              echo "  [Ë∞ÉËØï] ‰ªé refs/heads/ ÊèêÂèñ: ${TAG_NAME}"
            fi
            
            # Â¶ÇÊûúËøòÊòØËé∑Âèñ‰∏çÂà∞Ôºå‰ªé GitHub API Ëé∑Âèñ
            if [ -z "$TAG_NAME" ] || [ "$TAG_NAME" == "$GITHUB_REF" ]; then
              echo "  [Ë∞ÉËØï] ‰ªé GitHub API Ëé∑ÂèñÊúÄÊñ∞ Release..."
              TAG_NAME=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
                "https://api.github.com/repos/${{ github.repository }}/releases/latest" | \
                jq -r '.tag_name // empty')
              echo "  [Ë∞ÉËØï] API ËøîÂõû: ${TAG_NAME}"
            fi
          fi
          
          # Â¶ÇÊûú TAG_NAME ‰∏∫Á©∫Ôºå‰ªé GitHub API Ëé∑ÂèñÊúÄÊñ∞ Release
          if [ -z "$TAG_NAME" ] || [ "$TAG_NAME" == "" ]; then
            echo "üì° Êú™Êèê‰æõ Release Ê†áÁ≠æÔºå‰ªé GitHub API Ëé∑ÂèñÊúÄÊñ∞ Release..."
            TAG_NAME=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
              -H "Accept: application/vnd.github+json" \
              "https://api.github.com/repos/${{ github.repository }}/releases/latest" | \
              jq -r '.tag_name // empty')
            
            if [ -n "$TAG_NAME" ] && [ "$TAG_NAME" != "null" ] && [ "$TAG_NAME" != "" ]; then
              echo "‚úÖ Ëé∑ÂèñÂà∞ÊúÄÊñ∞ Release Ê†áÁ≠æ: ${TAG_NAME}"
            else
              echo "‚ùå Êó†Ê≥ï‰ªé GitHub API Ëé∑ÂèñÊúÄÊñ∞ Release Ê†áÁ≠æ"
              echo "  ËØ∑ÊâãÂä®ÊåáÂÆö release_tag ÂèÇÊï∞ÔºåÊàñÁ°Æ‰øù‰ªìÂ∫ì‰∏≠Ëá≥Â∞ëÊúâ‰∏Ä‰∏™Â∑≤ÂèëÂ∏ÉÁöÑ Release"
              exit 1
            fi
          fi
          
          # Á°Æ‰øù TAG_NAME ‰∏ç‰∏∫Á©∫
          if [ -z "$TAG_NAME" ] || [ "$TAG_NAME" == "" ] || [ "$TAG_NAME" == "null" ]; then
            echo "‚ùå Êó†Ê≥ïËé∑Âèñ Release Ê†áÁ≠æ"
            echo "  ËØ∑ÊâãÂä®ÊåáÂÆö release_tag ÂèÇÊï∞ÔºåÊàñÁ°Æ‰øù‰ªìÂ∫ì‰∏≠Ëá≥Â∞ëÊúâ‰∏Ä‰∏™Â∑≤ÂèëÂ∏ÉÁöÑ Release"
            exit 1
          fi
          
          VERSION=${TAG_NAME#v}  # ÂéªÊéâ v ÂâçÁºÄ
          echo "TAG_NAME=${TAG_NAME}" >> $GITHUB_OUTPUT
          echo "VERSION=${VERSION}" >> $GITHUB_OUTPUT
          echo "‚úÖ Release Ê†áÁ≠æ: ${TAG_NAME}"
          echo "‚úÖ ÁâàÊú¨Âè∑: ${VERSION}"

      - name: Get Release info
        uses: actions/github-script@v7
        id: release_info
        with:
          script: |
            // ‰ªé release ‰∫ã‰ª∂Ëé∑Âèñ release ‰ø°ÊÅØ
            let release;
            const tagName = '${{ steps.get_version.outputs.TAG_NAME }}';
            const repoOwner = context.repo.owner;
            const repoName = context.repo.repo;
            
            console.log(`üîç Ëé∑Âèñ Release ‰ø°ÊÅØ:`);
            console.log(`  Ê†áÁ≠æ: ${tagName}`);
            console.log(`  ‰ªìÂ∫ì: ${repoOwner}/${repoName}`);
            console.log(`  ‰∫ã‰ª∂Á±ªÂûã: ${context.eventName}`);
            
            if (context.payload.release && context.eventName === 'release') {
              // release ‰∫ã‰ª∂Áõ¥Êé•ÂåÖÂê´ release ‰ø°ÊÅØ
              release = context.payload.release;
              console.log('‚úÖ ‰ªé‰∫ã‰ª∂Ë¥üËΩΩËé∑Âèñ Release ‰ø°ÊÅØ');
            } else {
              // ÊâãÂä®Ëß¶ÂèëÊàñÂÖ∂‰ªñÊÉÖÂÜµÔºåÈÄöËøá API Ëé∑Âèñ
              const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/releases/tags/${tagName}`;
              console.log(`üì° ÈÄöËøá GitHub API Ëé∑Âèñ Release ‰ø°ÊÅØ...`);
              console.log(`  API URL: ${apiUrl}`);
              
              try {
                const { data } = await github.rest.repos.getReleaseByTag({
                  owner: repoOwner,
                  repo: repoName,
                  tag: tagName
                });
                release = data;
                console.log(`‚úÖ ÊàêÂäüËé∑Âèñ Release ‰ø°ÊÅØ`);
                console.log(`  Release ID: ${release.id}`);
                console.log(`  Release URL: ${release.html_url}`);
              } catch (error) {
                console.error(`‚ùå Ëé∑Âèñ Release Â§±Ë¥•:`);
                console.error(`  ÈîôËØØ‰ø°ÊÅØ: ${error.message}`);
                console.error(`  HTTP Áä∂ÊÄÅÁ†Å: ${error.status || 'N/A'}`);
                core.setFailed(`Failed to get release for tag ${tagName}: ${error.message}`);
                throw error;
              }
            }
            
            // ÊòæÁ§∫ Release ËØ¶ÁªÜ‰ø°ÊÅØ
            console.log(`\nüìã Release ËØ¶ÁªÜ‰ø°ÊÅØ:`);
            console.log(`  ID: ${release.id}`);
            console.log(`  ÂêçÁß∞: ${release.name || release.tag_name}`);
            console.log(`  Ê†áÁ≠æ: ${release.tag_name}`);
            console.log(`  ÂàõÂª∫Êó∂Èó¥: ${release.created_at}`);
            console.log(`  ÂèëÂ∏ÉÊó∂Èó¥: ${release.published_at || 'Êú™ÂèëÂ∏É'}`);
            console.log(`  ‰ΩúËÄÖ: ${release.author?.login || 'N/A'}`);
            console.log(`  URL: ${release.html_url}`);
            console.log(`  ËçâÁ®ø: ${release.draft ? 'ÊòØ' : 'Âê¶'}`);
            console.log(`  È¢ÑÂèëÂ∏É: ${release.prerelease ? 'ÊòØ' : 'Âê¶'}`);
            
            const assets = release.assets || [];
            console.log(`\nüì¶ ÊâæÂà∞ ${assets.length} ‰∏™ÊûÑÂª∫‰∫ßÁâ©:`);
            assets.forEach((asset, index) => {
              const sizeMB = (asset.size / 1024 / 1024).toFixed(2);
              const downloadCount = asset.download_count || 0;
              console.log(`  ${index + 1}. ${asset.name}`);
              console.log(`     Â§ßÂ∞è: ${sizeMB} MB`);
              console.log(`     ‰∏ãËΩΩÊ¨°Êï∞: ${downloadCount}`);
              console.log(`     ‰∏ãËΩΩ URL: ${asset.browser_download_url}`);
            });
            
            // È™åËØÅ Release Áä∂ÊÄÅ
            if (release.draft) {
              console.log('\n‚ö†Ô∏è Ë≠¶Âëä: Release ÊòØËçâÁ®øÁä∂ÊÄÅ');
            }
            if (release.prerelease) {
              console.log('\n‚ö†Ô∏è Ë≠¶Âëä: Release ÊòØÈ¢ÑÂèëÂ∏ÉÁâàÊú¨');
            }
            
            // ÊòæÁ§∫ Release Ê≠£ÊñáÔºàÂâç500Â≠óÁ¨¶Ôºâ
            if (release.body) {
              const bodyPreview = release.body.length > 500 
                ? release.body.substring(0, 500) + '...' 
                : release.body;
              console.log(`\nüìù Release Ê≠£ÊñáÈ¢ÑËßà:`);
              console.log(bodyPreview);
            }
            
            // ‰øùÂ≠ò release ‰ø°ÊÅØ
            core.setOutput('release_body', release.body || '');
            core.setOutput('release_name', release.name || release.tag_name);
            
            // ËøîÂõû assets ‰ø°ÊÅØ‰æõÂêéÁª≠Ê≠•È™§‰ΩøÁî®
            return JSON.stringify(assets.map(a => ({
              name: a.name,
              url: a.browser_download_url
            })));

      - name: Download assets files
        env:
          GH_TOKEN: ${{ github.token }}  # GitHub CLI ÈúÄË¶ÅËøô‰∏™ token
        run: |
          TAG_NAME="${{ steps.get_version.outputs.TAG_NAME }}"
          echo "üì• ‰∏ãËΩΩÊûÑÂª∫‰∫ßÁâ©Êñá‰ª∂..."
          echo "  Release Ê†áÁ≠æ: ${TAG_NAME}"
          
          mkdir -p release-assets
          echo "  ÁõÆÊ†áÁõÆÂΩï: $(realpath release-assets)"
          
          # ‰ΩøÁî® GitHub CLI ‰∏ãËΩΩÊñá‰ª∂ÔºàÂ¶ÇÊûúÂèØÁî®Ôºâ
          if command -v gh &> /dev/null; then
            echo "  ‰ΩøÁî® GitHub CLI ‰∏ãËΩΩÊñá‰ª∂..."
            echo "  ÂëΩ‰ª§: gh release download \"${TAG_NAME}\" -D release-assets"
            
            DOWNLOAD_OUTPUT=$(gh release download "${TAG_NAME}" -D release-assets 2>&1)
            DOWNLOAD_EXIT_CODE=$?
            
            if [ $DOWNLOAD_EXIT_CODE -eq 0 ]; then
              echo "‚úÖ GitHub CLI ‰∏ãËΩΩÂÆåÊàê"
            else
              echo "‚ö†Ô∏è GitHub CLI ‰∏ãËΩΩÂèØËÉΩÂ§±Ë¥• (ÈÄÄÂá∫Á†Å: ${DOWNLOAD_EXIT_CODE})"
              echo "  ËæìÂá∫: ${DOWNLOAD_OUTPUT}"
            fi
          else
            # ÊâãÂä®‰∏ãËΩΩÔºà‰ΩøÁî® curlÔºâ
            echo "  ‰ΩøÁî® curl ÊâãÂä®‰∏ãËΩΩÊñá‰ª∂..."
            ASSETS='${{ steps.release_info.outputs.result }}'
            
            ASSET_COUNT=$(echo "$ASSETS" | jq 'length' 2>/dev/null || echo "0")
            echo "  ÈúÄË¶Å‰∏ãËΩΩ ${ASSET_COUNT} ‰∏™Êñá‰ª∂"
            
            DOWNLOAD_SUCCESS=0
            DOWNLOAD_FAILED=0
            
            echo "$ASSETS" | jq -r '.[] | "\(.url)|\(.name)"' | while IFS='|' read -r url name; do
              if [ -n "$url" ] && [ -n "$name" ]; then
                echo "  üì¶ ‰∏ãËΩΩ ${name}..."
                echo "    ‰∏ãËΩΩ URL: ${url}"
                
                DOWNLOAD_RESPONSE=$(curl -s -w "\n%{http_code}" -L \
                  -H "Authorization: token ${{ github.token }}" \
                  -o "release-assets/${name}" \
                  "${url}")
                
                HTTP_CODE=$(echo "$DOWNLOAD_RESPONSE" | tail -n1)
                
                if [ "$HTTP_CODE" = "200" ]; then
                  FILE_SIZE=$(du -h "release-assets/${name}" | cut -f1)
                  echo "    ‚úÖ ${name} ‰∏ãËΩΩÊàêÂäü (${FILE_SIZE})"
                else
                  echo "    ‚ùå ${name} ‰∏ãËΩΩÂ§±Ë¥• (HTTP ${HTTP_CODE})"
                fi
              fi
            done
          fi
          
          echo ""
          echo "üìã Â∑≤‰∏ãËΩΩÁöÑÊñá‰ª∂ÂàóË°®:"
          ls -lh release-assets/ || echo "  ÁõÆÂΩï‰∏∫Á©∫Êàñ‰∏çÂ≠òÂú®"
          
          FILE_COUNT=$(find release-assets -type f 2>/dev/null | wc -l)
          TOTAL_SIZE=$(du -sh release-assets 2>/dev/null | cut -f1 || echo "0")
          echo ""
          echo "  Êñá‰ª∂Êï∞Èáè: ${FILE_COUNT}"
          echo "  ÊÄªÂ§ßÂ∞è: ${TOTAL_SIZE}"

      - name: Create Gitee Release
        env:
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}
          GITEE_REPO_OWNER: ${{ secrets.GITEE_REPO_OWNER }}
          GITEE_REPO_NAME: ${{ secrets.GITEE_REPO_NAME }}
        run: |
          TAG_NAME_RAW="${{ steps.get_version.outputs.TAG_NAME }}"
          RELEASE_NAME="${{ steps.release_info.outputs.release_name }}"
          RELEASE_BODY="${{ steps.release_info.outputs.release_body }}"
          
          # Ê∏ÖÁêÜ TAG_NAMEÔºöÂéªÈô§Êç¢Ë°åÁ¨¶„ÄÅÂõûËΩ¶Á¨¶ÂíåÂâçÂêéÁ©∫Ê†º
          TAG_NAME=$(printf '%s' "${TAG_NAME_RAW}" | tr -d '\n\r\t' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
          
          # Ê∏ÖÁêÜÂπ∂ÂéªÈô§Êç¢Ë°åÁ¨¶„ÄÅÂõûËΩ¶Á¨¶ÂíåÂâçÂêéÁ©∫Ê†º
          GITEE_REPO_OWNER=$(printf '%s' "${GITEE_REPO_OWNER}" | tr -d '\n\r\t' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
          GITEE_REPO_NAME=$(printf '%s' "${GITEE_REPO_NAME}" | tr -d '\n\r\t' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
          
          # URL ÁºñÁ†Å
          GITEE_REPO_OWNER_ENCODED=$(printf '%s' "${GITEE_REPO_OWNER}" | jq -sRr @uri)
          GITEE_REPO_NAME_ENCODED=$(printf '%s' "${GITEE_REPO_NAME}" | jq -sRr @uri)
          TAG_NAME_ENCODED=$(printf '%s' "${TAG_NAME}" | jq -sRr @uri)
          GITEE_REPO="${GITEE_REPO_OWNER}/${GITEE_REPO_NAME}"
          
          echo "üöÄ ÂàõÂª∫ Gitee Release..."
          echo "  Ê†áÁ≠æ: ${TAG_NAME}"
          echo "  ÂêçÁß∞: ${RELEASE_NAME}"
          echo "  ‰ªìÂ∫ì: ${GITEE_REPO}"
          echo "  Owner: ${GITEE_REPO_OWNER}"
          echo "  Repo Name: ${GITEE_REPO_NAME}"
          echo "  Ê†áÁ≠æ (ÁºñÁ†ÅÂêé): ${TAG_NAME_ENCODED}"
          
          # Ëé∑ÂèñÊ†áÁ≠æÂØπÂ∫îÁöÑ commit SHAÔºàtarget_commitishÔºâ
          echo "üîç Ëé∑ÂèñÊ†áÁ≠æÂØπÂ∫îÁöÑ commit SHA..."
          TAG_SHA=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/git/refs/tags/${TAG_NAME}" | \
            jq -r '.object.sha // empty')
          
          # Â¶ÇÊûúÈÄöËøá refs/tags Ëé∑Âèñ‰∏çÂà∞ÔºåÂ∞ùËØïÈÄöËøá tags API Ëé∑Âèñ
          if [ -z "$TAG_SHA" ] || [ "$TAG_SHA" == "null" ]; then
            echo "  [Ë∞ÉËØï] ÈÄöËøá refs/tags Êú™Ëé∑ÂèñÂà∞ÔºåÂ∞ùËØïÈÄöËøá tags API..."
            TAG_SHA=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
              "https://api.github.com/repos/${{ github.repository }}/git/tags/${TAG_NAME}" | \
              jq -r '.object.sha // empty')
          fi
          
          # Â¶ÇÊûúËøòÊòØËé∑Âèñ‰∏çÂà∞ÔºåÂ∞ùËØïËé∑ÂèñÊ†áÁ≠æÂØπË±°ÊåáÂêëÁöÑ commit
          if [ -z "$TAG_SHA" ] || [ "$TAG_SHA" == "null" ]; then
            echo "  [Ë∞ÉËØï] ÈÄöËøá tags API Êú™Ëé∑ÂèñÂà∞ÔºåÂ∞ùËØïËé∑ÂèñÊ†áÁ≠æÊåáÂêëÁöÑ commit..."
            TAG_INFO=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
              "https://api.github.com/repos/${{ github.repository }}/git/refs/tags/${TAG_NAME}")
            TAG_OBJECT_SHA=$(echo "$TAG_INFO" | jq -r '.object.sha // empty')
            if [ -n "$TAG_OBJECT_SHA" ] && [ "$TAG_OBJECT_SHA" != "null" ]; then
              TAG_OBJECT=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
                "https://api.github.com/repos/${{ github.repository }}/git/tags/${TAG_OBJECT_SHA}")
              TAG_SHA=$(echo "$TAG_OBJECT" | jq -r '.object.sha // empty')
            fi
          fi
          
          if [ -z "$TAG_SHA" ] || [ "$TAG_SHA" == "null" ]; then
            echo "‚ö†Ô∏è Ë≠¶Âëä: Êó†Ê≥ïËé∑ÂèñÊ†áÁ≠æ ${TAG_NAME} ÂØπÂ∫îÁöÑ commit SHAÔºåÂ∞Ü‰ΩøÁî®ÈªòËÆ§ÂàÜÊîØ"
            TARGET_COMMITISH=""
          else
            TARGET_COMMITISH="${TAG_SHA}"
            echo "‚úÖ Ê†áÁ≠æ ${TAG_NAME} ÂØπÂ∫îÁöÑ commit SHA: ${TAG_SHA:0:7}..."
          fi
          
          # È¶ñÂÖàÈ™åËØÅ‰ªìÂ∫ìÊòØÂê¶Â≠òÂú®
          echo "üîç È™åËØÅ Gitee ‰ªìÂ∫ìÊòØÂê¶Â≠òÂú®..."
          REPO_API_URL="https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}"
          echo "  API URL: ${REPO_API_URL}"
          
          REPO_CHECK=$(curl -s -w "\n%{http_code}" -X GET \
            -H "Authorization: token ${GITEE_TOKEN}" \
            "${REPO_API_URL}")
          
          REPO_CHECK_HTTP_CODE=$(echo "$REPO_CHECK" | tail -n1)
          REPO_CHECK_BODY=$(echo "$REPO_CHECK" | sed '$d')
          
          echo "  HTTP Áä∂ÊÄÅÁ†Å: ${REPO_CHECK_HTTP_CODE}"
          
          if [ "$REPO_CHECK_HTTP_CODE" != "200" ]; then
            ERROR_MSG=$(echo "$REPO_CHECK_BODY" | jq -r '.message // .error // "Êú™Áü•ÈîôËØØ"' 2>/dev/null || echo "$REPO_CHECK_BODY")
            echo "‚ùå Gitee ‰ªìÂ∫ì‰∏çÂ≠òÂú®ÊàñÊó†Ê≥ïËÆøÈóÆ (HTTP ${REPO_CHECK_HTTP_CODE})"
            echo "  API URL: ${REPO_API_URL}"
            echo "  ÈîôËØØ‰ø°ÊÅØ: ${ERROR_MSG}"
            echo "  ÂÆåÊï¥ÂìçÂ∫î: ${REPO_CHECK_BODY}"
            echo ""
            echo "  ËØ∑Ê£ÄÊü•Ôºö"
            echo "    1. GITEE_REPO_OWNER ÊòØÂê¶Ê≠£Á°Æ: ${GITEE_REPO_OWNER}"
            echo "    2. GITEE_REPO_NAME ÊòØÂê¶Ê≠£Á°Æ: ${GITEE_REPO_NAME}"
            echo "    3. GITEE_TOKEN ÊòØÂê¶ÊúâËÆøÈóÆËØ•‰ªìÂ∫ìÁöÑÊùÉÈôê"
            exit 1
          fi
          
          REPO_FULL_NAME=$(echo "$REPO_CHECK_BODY" | jq -r '.full_name // empty' 2>/dev/null || echo "")
          REPO_DESCRIPTION=$(echo "$REPO_CHECK_BODY" | jq -r '.description // empty' 2>/dev/null || echo "")
          REPO_DEFAULT_BRANCH=$(echo "$REPO_CHECK_BODY" | jq -r '.default_branch // "master"' 2>/dev/null || echo "master")
          echo "‚úÖ Gitee ‰ªìÂ∫ìÈ™åËØÅÈÄöËøá"
          if [ -n "$REPO_FULL_NAME" ]; then
            echo "  ‰ªìÂ∫ìÂÖ®Âêç: ${REPO_FULL_NAME}"
          fi
          if [ -n "$REPO_DESCRIPTION" ]; then
            echo "  ‰ªìÂ∫ìÊèèËø∞: ${REPO_DESCRIPTION}"
          fi
          echo "  ÈªòËÆ§ÂàÜÊîØ: ${REPO_DEFAULT_BRANCH}"
          
          # Â¶ÇÊûúËé∑ÂèñÂà∞‰∫Ü commit SHAÔºåÊ£ÄÊü•ËØ• commit ÊòØÂê¶Â≠òÂú®‰∫é Gitee ‰ªìÂ∫ì
          if [ -n "$TARGET_COMMITISH" ] && [ "$TARGET_COMMITISH" != "" ]; then
            echo "üîç Ê£ÄÊü• commit ${TARGET_COMMITISH:0:7}... ÊòØÂê¶Â≠òÂú®‰∫é Gitee ‰ªìÂ∫ì..."
            COMMIT_CHECK_API_URL="https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/git/commits/${TARGET_COMMITISH}"
            echo "  API URL: ${COMMIT_CHECK_API_URL}"
            
            COMMIT_CHECK=$(curl -s -w "\n%{http_code}" -X GET \
              -H "Authorization: token ${GITEE_TOKEN}" \
              "${COMMIT_CHECK_API_URL}")
            
            COMMIT_CHECK_HTTP_CODE=$(echo "$COMMIT_CHECK" | tail -n1)
            COMMIT_CHECK_BODY=$(echo "$COMMIT_CHECK" | sed '$d')
            
            echo "  HTTP Áä∂ÊÄÅÁ†Å: ${COMMIT_CHECK_HTTP_CODE}"
            
            if [ "$COMMIT_CHECK_HTTP_CODE" != "200" ]; then
              ERROR_MSG=$(echo "$COMMIT_CHECK_BODY" | jq -r '.message // .error // "Êú™Áü•ÈîôËØØ"' 2>/dev/null || echo "$COMMIT_CHECK_BODY")
              echo "‚ö†Ô∏è Commit ${TARGET_COMMITISH:0:7}... ‰∏çÂ≠òÂú®‰∫é Gitee ‰ªìÂ∫ì (HTTP ${COMMIT_CHECK_HTTP_CODE})"
              echo "  ÈîôËØØ‰ø°ÊÅØ: ${ERROR_MSG}"
              echo ""
              echo "  Â∞ùËØï‰ΩøÁî®ÈªòËÆ§ÂàÜÊîØ ${REPO_DEFAULT_BRANCH} ÁöÑÊúÄÊñ∞ commit..."
              
              # Ëé∑ÂèñÈªòËÆ§ÂàÜÊîØÁöÑÊúÄÊñ∞ commit
              BRANCH_API_URL="https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/branches/${REPO_DEFAULT_BRANCH}"
              BRANCH_CHECK=$(curl -s -w "\n%{http_code}" -X GET \
                -H "Authorization: token ${GITEE_TOKEN}" \
                "${BRANCH_API_URL}")
              
              BRANCH_CHECK_HTTP_CODE=$(echo "$BRANCH_CHECK" | tail -n1)
              BRANCH_CHECK_BODY=$(echo "$BRANCH_CHECK" | sed '$d')
              
              if [ "$BRANCH_CHECK_HTTP_CODE" = "200" ]; then
                BRANCH_COMMIT_SHA=$(echo "$BRANCH_CHECK_BODY" | jq -r '.commit.sha // empty' 2>/dev/null || echo "")
                if [ -n "$BRANCH_COMMIT_SHA" ]; then
                  echo "‚úÖ ‰ΩøÁî®ÈªòËÆ§ÂàÜÊîØ ${REPO_DEFAULT_BRANCH} ÁöÑÊúÄÊñ∞ commit: ${BRANCH_COMMIT_SHA:0:7}..."
                  TARGET_COMMITISH="${BRANCH_COMMIT_SHA}"
                else
                  echo "‚ö†Ô∏è Êó†Ê≥ïËé∑ÂèñÈªòËÆ§ÂàÜÊîØÁöÑ commitÔºåÂ∞Ü‰ΩøÁî®ÂàÜÊîØÂêç"
                  TARGET_COMMITISH="${REPO_DEFAULT_BRANCH}"
                fi
              else
                echo "‚ö†Ô∏è Êó†Ê≥ïËé∑ÂèñÈªòËÆ§ÂàÜÊîØ‰ø°ÊÅØÔºåÂ∞Ü‰ΩøÁî®ÂàÜÊîØÂêç"
                TARGET_COMMITISH="${REPO_DEFAULT_BRANCH}"
              fi
            else
              echo "‚úÖ Commit ${TARGET_COMMITISH:0:7}... Â≠òÂú®‰∫é Gitee ‰ªìÂ∫ì"
            fi
            echo ""
          fi
          
          # Ê£ÄÊü•Ê†áÁ≠æÊòØÂê¶Â≠òÂú®ÔºåÂ¶ÇÊûú‰∏çÂ≠òÂú®ÂàôÂàõÂª∫
          echo "üîç Ê£ÄÊü• Gitee Ê†áÁ≠æÊòØÂê¶Â≠òÂú®..."
          TAG_CHECK_API_URL="https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/tags/${TAG_NAME_ENCODED}"
          echo "  Ê†áÁ≠æÊ£ÄÊü• API URL: ${TAG_CHECK_API_URL}"
          
          TAG_CHECK=$(curl -s -w "\n%{http_code}" -X GET \
            -H "Authorization: token ${GITEE_TOKEN}" \
            "${TAG_CHECK_API_URL}")
          
          TAG_CHECK_HTTP_CODE=$(echo "$TAG_CHECK" | tail -n1)
          TAG_CHECK_BODY=$(echo "$TAG_CHECK" | sed '$d')
          
          echo "  HTTP Áä∂ÊÄÅÁ†Å: ${TAG_CHECK_HTTP_CODE}"
          
          if [ "$TAG_CHECK_HTTP_CODE" != "200" ]; then
            echo "‚ö†Ô∏è Ê†áÁ≠æ ${TAG_NAME} ‰∏çÂ≠òÂú®ÔºåÈúÄË¶ÅÂàõÂª∫..."
            
            # Á°Æ‰øùÊúâ commit SHA
            if [ -z "$TARGET_COMMITISH" ] || [ "$TARGET_COMMITISH" == "" ]; then
              echo "‚ùå ÈîôËØØ: Êó†Ê≥ïÂàõÂª∫Ê†áÁ≠æÔºåÂõ†‰∏∫Áº∫Â∞ë commit SHA"
              echo "  ËØ∑Á°Æ‰øùÊ†áÁ≠æ ${TAG_NAME} Âú® GitHub ‰∏≠Â≠òÂú®"
              exit 1
            fi
            
            # ÂàõÂª∫Ê†áÁ≠æ
            echo "üìù ÂàõÂª∫ Gitee Ê†áÁ≠æ ${TAG_NAME}..."
            CREATE_TAG_API_URL="https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/tags"
            echo "  ÂàõÂª∫Ê†áÁ≠æ API URL: ${CREATE_TAG_API_URL}"
            
            CREATE_TAG_BODY=$(echo "{
              \"refs\": \"${TARGET_COMMITISH}\",
              \"tag_name\": \"${TAG_NAME}\",
              \"message\": \"Release ${TAG_NAME}\"
            }" | jq -c .)
            echo "  ËØ∑Ê±Ç‰Ωì: ${CREATE_TAG_BODY}"
            
            CREATE_TAG_RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
              -H "Content-Type: application/json" \
              -H "Authorization: token ${GITEE_TOKEN}" \
              -d "${CREATE_TAG_BODY}" \
              "${CREATE_TAG_API_URL}")
            
            CREATE_TAG_HTTP_CODE=$(echo "$CREATE_TAG_RESPONSE" | tail -n1)
            CREATE_TAG_BODY_RESPONSE=$(echo "$CREATE_TAG_RESPONSE" | sed '$d')
            
            echo "  ÂìçÂ∫î HTTP Áä∂ÊÄÅÁ†Å: ${CREATE_TAG_HTTP_CODE}"
            
            if [ "$CREATE_TAG_HTTP_CODE" = "200" ] || [ "$CREATE_TAG_HTTP_CODE" = "201" ]; then
              echo "‚úÖ Ê†áÁ≠æ ${TAG_NAME} ÂàõÂª∫ÊàêÂäü"
            else
              ERROR_MSG=$(echo "$CREATE_TAG_BODY_RESPONSE" | jq -r '.message // .error // "Êú™Áü•ÈîôËØØ"' 2>/dev/null || echo "$CREATE_TAG_BODY_RESPONSE")
              echo "‚ùå ÂàõÂª∫Ê†áÁ≠æÂ§±Ë¥• (HTTP ${CREATE_TAG_HTTP_CODE})"
              echo "  ÈîôËØØ‰ø°ÊÅØ: ${ERROR_MSG}"
              echo "  ÂÆåÊï¥ÂìçÂ∫î: ${CREATE_TAG_BODY_RESPONSE}"
              
              # Â¶ÇÊûúÈîôËØØÊòØÊ†áÁ≠æÂ∑≤Â≠òÂú®ÔºåÁªßÁª≠ÊâßË°å
              if echo "$ERROR_MSG" | grep -qi "Â∑≤Â≠òÂú®\|already exists\|duplicate"; then
                echo "‚ö†Ô∏è Ê†áÁ≠æÂèØËÉΩÂ∑≤Â≠òÂú®ÔºåÁªßÁª≠ÊâßË°å..."
              else
                exit 1
              fi
            fi
          else
            TAG_COMMIT=$(echo "$TAG_CHECK_BODY" | jq -r '.commit.sha // empty' 2>/dev/null || echo "")
            echo "‚úÖ Ê†áÁ≠æ ${TAG_NAME} Â∑≤Â≠òÂú®"
            if [ -n "$TAG_COMMIT" ]; then
              echo "  Ê†áÁ≠æÊåáÂêëÁöÑ commit: ${TAG_COMMIT:0:7}..."
            fi
          fi
          
          # Ê£ÄÊü• Release ÊòØÂê¶Â∑≤Â≠òÂú®
          echo "üîç Ê£ÄÊü• Gitee Release ÊòØÂê¶Â∑≤Â≠òÂú®..."
          RELEASE_CHECK_API_URL="https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/releases/tags/${TAG_NAME_ENCODED}"
          echo "  API URL: ${RELEASE_CHECK_API_URL}"
          
          EXISTING_RELEASE=$(curl -s -w "\n%{http_code}" -X GET \
            -H "Authorization: token ${GITEE_TOKEN}" \
            "${RELEASE_CHECK_API_URL}")
          
          EXISTING_HTTP_CODE=$(echo "$EXISTING_RELEASE" | tail -n1)
          EXISTING_BODY=$(echo "$EXISTING_RELEASE" | sed '$d')
          
          echo "  HTTP Áä∂ÊÄÅÁ†Å: ${EXISTING_HTTP_CODE}"
          
          if [ "$EXISTING_HTTP_CODE" = "200" ] && echo "${EXISTING_BODY}" | grep -q '"id"'; then
            RELEASE_ID=$(echo "${EXISTING_BODY}" | jq -r '.id // empty')
            RELEASE_EXISTING_NAME=$(echo "${EXISTING_BODY}" | jq -r '.name // empty' 2>/dev/null || echo "")
            RELEASE_EXISTING_CREATED=$(echo "${EXISTING_BODY}" | jq -r '.created_at // empty' 2>/dev/null || echo "")
            echo "‚ö†Ô∏è Gitee Release Â∑≤Â≠òÂú® (ID: ${RELEASE_ID})ÔºåÂ∞ÜÊõ¥Êñ∞..."
            if [ -n "$RELEASE_EXISTING_NAME" ]; then
              echo "  Áé∞Êúâ Release ÂêçÁß∞: ${RELEASE_EXISTING_NAME}"
            fi
            if [ -n "$RELEASE_EXISTING_CREATED" ]; then
              echo "  ÂàõÂª∫Êó∂Èó¥: ${RELEASE_EXISTING_CREATED}"
            fi
            
            # Êõ¥Êñ∞Áé∞Êúâ Release
            UPDATE_API_URL="https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/releases/${RELEASE_ID}"
            echo "  Êõ¥Êñ∞ API URL: ${UPDATE_API_URL}"
            
            # ÊûÑÂª∫Êõ¥Êñ∞ËØ∑Ê±Ç‰Ωì
            UPDATE_BODY_JSON=$(echo "${RELEASE_BODY}" | jq -Rs .)
            if [ -n "$TARGET_COMMITISH" ]; then
              REQUEST_BODY=$(echo "{
                \"tag_name\": \"${TAG_NAME}\",
                \"name\": \"${RELEASE_NAME}\",
                \"body\": ${UPDATE_BODY_JSON},
                \"target_commitish\": \"${TARGET_COMMITISH}\",
                \"prerelease\": false
              }" | jq -c .)
            else
              REQUEST_BODY=$(echo "{
                \"tag_name\": \"${TAG_NAME}\",
                \"name\": \"${RELEASE_NAME}\",
                \"body\": ${UPDATE_BODY_JSON},
                \"prerelease\": false
              }" | jq -c .)
            fi
            echo "  ËØ∑Ê±Ç‰Ωì: ${REQUEST_BODY}"
            
            RESPONSE=$(curl -s -w "\n%{http_code}" -X PATCH \
              -H "Content-Type: application/json" \
              -H "Authorization: token ${GITEE_TOKEN}" \
              -d "${REQUEST_BODY}" \
              "${UPDATE_API_URL}")
          else
            # ÂàõÂª∫Êñ∞ Release
            echo "üìù ÂàõÂª∫Êñ∞ÁöÑ Gitee Release..."
            CREATE_API_URL="https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/releases"
            echo "  ÂàõÂª∫ API URL: ${CREATE_API_URL}"
            
            # ÊûÑÂª∫ÂàõÂª∫ËØ∑Ê±Ç‰Ωì
            CREATE_BODY_JSON=$(echo "${RELEASE_BODY}" | jq -Rs .)
            if [ -n "$TARGET_COMMITISH" ]; then
              REQUEST_BODY=$(echo "{
                \"tag_name\": \"${TAG_NAME}\",
                \"name\": \"${RELEASE_NAME}\",
                \"body\": ${CREATE_BODY_JSON},
                \"target_commitish\": \"${TARGET_COMMITISH}\",
                \"prerelease\": false
              }" | jq -c .)
            else
              REQUEST_BODY=$(echo "{
              \"tag_name\": \"${TAG_NAME}\",
              \"name\": \"${RELEASE_NAME}\",
                \"body\": ${CREATE_BODY_JSON},
              \"prerelease\": false
              }" | jq -c .)
            fi
            echo "  ËØ∑Ê±Ç‰Ωì: ${REQUEST_BODY}"
            
            RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
              -H "Content-Type: application/json" \
              -H "Authorization: token ${GITEE_TOKEN}" \
              -d "${REQUEST_BODY}" \
              "${CREATE_API_URL}")
          fi
          
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          RESPONSE_BODY=$(echo "$RESPONSE" | sed '$d')
          
          echo "  ÂìçÂ∫î HTTP Áä∂ÊÄÅÁ†Å: ${HTTP_CODE}"
          
          # Ê£ÄÊü•ÂìçÂ∫î
          if [ "$HTTP_CODE" = "200" ] || [ "$HTTP_CODE" = "201" ]; then
            if echo "${RESPONSE_BODY}" | grep -q '"id"'; then
              RELEASE_ID=$(echo "${RESPONSE_BODY}" | jq -r '.id // empty')
              RELEASE_TAG_NAME=$(echo "${RESPONSE_BODY}" | jq -r '.tag_name // empty' 2>/dev/null || echo "")
              RELEASE_CREATED=$(echo "${RESPONSE_BODY}" | jq -r '.created_at // empty' 2>/dev/null || echo "")
              echo "‚úÖ Gitee Release ÂàõÂª∫/Êõ¥Êñ∞ÊàêÂäü"
              echo "  Release ID: ${RELEASE_ID}"
              if [ -n "$RELEASE_TAG_NAME" ]; then
                echo "  Ê†áÁ≠æ: ${RELEASE_TAG_NAME}"
              fi
              if [ -n "$RELEASE_CREATED" ]; then
                echo "  ÂàõÂª∫Êó∂Èó¥: ${RELEASE_CREATED}"
              fi
              echo "  ÂÆåÊï¥ÂìçÂ∫î: ${RESPONSE_BODY}"
            else
              echo "‚ö†Ô∏è ÂìçÂ∫îÊ†ºÂºèÂºÇÂ∏∏Ôºå‰ΩÜ HTTP Áä∂ÊÄÅÁ†Å‰∏∫ ${HTTP_CODE}"
              echo "  ÂìçÂ∫îÂÜÖÂÆπ: ${RESPONSE_BODY}"
            fi
          else
            ERROR_MSG=$(echo "${RESPONSE_BODY}" | jq -r '.message // .error // "Êú™Áü•ÈîôËØØ"' 2>/dev/null || echo "${RESPONSE_BODY}")
            echo "‚ùå Gitee Release ÂàõÂª∫/Êõ¥Êñ∞Â§±Ë¥• (HTTP ${HTTP_CODE})"
            echo "  ÈîôËØØ‰ø°ÊÅØ: ${ERROR_MSG}"
            echo "  ÂÆåÊï¥ÂìçÂ∫î: ${RESPONSE_BODY}"
            exit 1
          fi

      - name: Upload assets to Gitee Release
        env:
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}
          GITEE_REPO_OWNER: ${{ secrets.GITEE_REPO_OWNER }}
          GITEE_REPO_NAME: ${{ secrets.GITEE_REPO_NAME }}
        run: |
          TAG_NAME="${{ steps.get_version.outputs.TAG_NAME }}"
          
          # Ê∏ÖÁêÜÂπ∂ÂéªÈô§Êç¢Ë°åÁ¨¶„ÄÅÂõûËΩ¶Á¨¶ÂíåÂâçÂêéÁ©∫Ê†º
          GITEE_REPO_OWNER=$(printf '%s' "${GITEE_REPO_OWNER}" | tr -d '\n\r\t' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
          GITEE_REPO_NAME=$(printf '%s' "${GITEE_REPO_NAME}" | tr -d '\n\r\t' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
          
          # URL ÁºñÁ†Å
          GITEE_REPO_OWNER_ENCODED=$(printf '%s' "${GITEE_REPO_OWNER}" | jq -sRr @uri)
          GITEE_REPO_NAME_ENCODED=$(printf '%s' "${GITEE_REPO_NAME}" | jq -sRr @uri)
          TAG_NAME_ENCODED=$(printf '%s' "${TAG_NAME}" | jq -sRr @uri)
          GITEE_REPO="${GITEE_REPO_OWNER}/${GITEE_REPO_NAME}"
          
          echo "üì§ ‰∏ä‰º†ÊûÑÂª∫‰∫ßÁâ©Âà∞ Gitee Release..."
          echo "  Ê†áÁ≠æ: ${TAG_NAME}"
          echo "  ‰ªìÂ∫ì: ${GITEE_REPO}"
          echo "  Owner: ${GITEE_REPO_OWNER}"
          echo "  Repo Name: ${GITEE_REPO_NAME}"
          
          # È¶ñÂÖàËé∑Âèñ Release IDÔºàÁî®‰∫é‰∏ä‰º†Êñá‰ª∂Ôºâ
          echo "üîç Ëé∑Âèñ Gitee Release ID..."
          RELEASE_INFO_API_URL="https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/releases/tags/${TAG_NAME_ENCODED}"
          echo "  API URL: ${RELEASE_INFO_API_URL}"
          
          RELEASE_INFO=$(curl -s -w "\n%{http_code}" -X GET \
            -H "Authorization: token ${GITEE_TOKEN}" \
            "${RELEASE_INFO_API_URL}")
          
          RELEASE_INFO_HTTP_CODE=$(echo "$RELEASE_INFO" | tail -n1)
          RELEASE_INFO_BODY=$(echo "$RELEASE_INFO" | sed '$d')
          
          echo "  HTTP Áä∂ÊÄÅÁ†Å: ${RELEASE_INFO_HTTP_CODE}"
          
          if [ "$RELEASE_INFO_HTTP_CODE" != "200" ] || ! echo "${RELEASE_INFO_BODY}" | grep -q '"id"'; then
            echo "‚ùå Êó†Ê≥ïËé∑Âèñ Gitee Release ‰ø°ÊÅØ (HTTP ${RELEASE_INFO_HTTP_CODE})"
            echo "  API URL: ${RELEASE_INFO_API_URL}"
            echo "  ÂìçÂ∫î: ${RELEASE_INFO_BODY}"
            exit 1
          fi
          
          RELEASE_ID=$(echo "${RELEASE_INFO_BODY}" | jq -r '.id // empty')
          RELEASE_NAME_FROM_API=$(echo "${RELEASE_INFO_BODY}" | jq -r '.name // empty' 2>/dev/null || echo "")
          echo "‚úÖ ÊâæÂà∞ Gitee Release"
          echo "  Release ID: ${RELEASE_ID}"
          if [ -n "$RELEASE_NAME_FROM_API" ]; then
            echo "  Release ÂêçÁß∞: ${RELEASE_NAME_FROM_API}"
          fi
          
          # Ê£ÄÊü•Êñá‰ª∂Êï∞Èáè
          FILE_COUNT=$(find release-assets -type f 2>/dev/null | wc -l)
          if [ "$FILE_COUNT" -eq 0 ]; then
            echo "‚ö†Ô∏è Êú™ÊâæÂà∞ÈúÄË¶Å‰∏ä‰º†ÁöÑÊñá‰ª∂"
            exit 0
          fi
          
          echo "  ÊâæÂà∞ ${FILE_COUNT} ‰∏™Êñá‰ª∂ÈúÄË¶Å‰∏ä‰º†"
          
          UPLOAD_SUCCESS=0
          UPLOAD_FAILED=0
          
          # ‰∏ä‰º†ÊâÄÊúâÊñá‰ª∂
          UPLOAD_API_BASE_URL="https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/releases/${RELEASE_ID}/attach_files"
          echo "  ‰∏ä‰º† API URL: ${UPLOAD_API_BASE_URL}"
          
          for file in release-assets/*; do
            if [ -f "$file" ]; then
              filename=$(basename "$file")
              filesize=$(du -h "$file" | cut -f1)
              filepath=$(realpath "$file" 2>/dev/null || echo "$file")
              echo "  üì¶ ‰∏ä‰º† ${filename} (${filesize})..."
              echo "    Êñá‰ª∂Ë∑ØÂæÑ: ${filepath}"
              
              UPLOAD_RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
                -H "Authorization: token ${GITEE_TOKEN}" \
                -F "file=@${file}" \
                "${UPLOAD_API_BASE_URL}")
              
              HTTP_CODE=$(echo "$UPLOAD_RESPONSE" | tail -n1)
              RESPONSE_BODY=$(echo "$UPLOAD_RESPONSE" | sed '$d')
              
              echo "    HTTP Áä∂ÊÄÅÁ†Å: ${HTTP_CODE}"
              
              if [ "$HTTP_CODE" -eq 201 ] || [ "$HTTP_CODE" -eq 200 ]; then
                echo "    ‚úÖ ${filename} ‰∏ä‰º†ÊàêÂäü"
                echo "    ÂìçÂ∫î: ${RESPONSE_BODY}"
                UPLOAD_SUCCESS=$((UPLOAD_SUCCESS + 1))
              elif echo "$RESPONSE_BODY" | grep -q "already exists\|Â∑≤Â≠òÂú®"; then
                echo "    ‚ö†Ô∏è ${filename} Â∑≤Â≠òÂú®ÔºåË∑≥Ëøá"
                echo "    ÂìçÂ∫î: ${RESPONSE_BODY}"
                UPLOAD_SUCCESS=$((UPLOAD_SUCCESS + 1))
              else
                ERROR_MSG=$(echo "$RESPONSE_BODY" | jq -r '.message // .error // "Êú™Áü•ÈîôËØØ"' 2>/dev/null || echo "HTTP ${HTTP_CODE}")
                echo "    ‚ùå ${filename} ‰∏ä‰º†Â§±Ë¥•: ${ERROR_MSG}"
                echo "    ÂÆåÊï¥ÂìçÂ∫î: ${RESPONSE_BODY}"
                UPLOAD_FAILED=$((UPLOAD_FAILED + 1))
              fi
            fi
          done
          
          echo ""
          echo "üìä ‰∏ä‰º†ÁªüËÆ°:"
          echo "  ‚úÖ ÊàêÂäü: ${UPLOAD_SUCCESS}"
          echo "  ‚ùå Â§±Ë¥•: ${UPLOAD_FAILED}"
          
          if [ "$UPLOAD_FAILED" -gt 0 ]; then
            echo "‚ö†Ô∏è ÈÉ®ÂàÜÊñá‰ª∂‰∏ä‰º†Â§±Ë¥•Ôºå‰ΩÜÁªßÁª≠ÊâßË°åÂêéÁª≠Ê≠•È™§"
          else
            echo "‚úÖ ÊâÄÊúâÊûÑÂª∫‰∫ßÁâ©‰∏ä‰º†ÂÆåÊàê"
          fi

      - name: Sync update config to Gitee
        env:
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}
          GITEE_REPO_OWNER: ${{ secrets.GITEE_REPO_OWNER }}
          GITEE_REPO_NAME: ${{ secrets.GITEE_REPO_NAME }}
        run: |
          echo "üîÑ ÂêåÊ≠•Êõ¥Êñ∞ÈÖçÁΩÆÂà∞ Gitee..."
          
          # Ê∏ÖÁêÜÂπ∂ÂéªÈô§Êç¢Ë°åÁ¨¶„ÄÅÂõûËΩ¶Á¨¶ÂíåÂâçÂêéÁ©∫Ê†º
          GITEE_REPO_OWNER=$(printf '%s' "${GITEE_REPO_OWNER}" | tr -d '\n\r\t' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
          GITEE_REPO_NAME=$(printf '%s' "${GITEE_REPO_NAME}" | tr -d '\n\r\t' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
          GITEE_REPO="${GITEE_REPO_OWNER}/${GITEE_REPO_NAME}"
          TAG_NAME="${{ steps.get_version.outputs.TAG_NAME }}"
          
          echo "  Owner: ${GITEE_REPO_OWNER}"
          echo "  Repo Name: ${GITEE_REPO_NAME}"
          echo "  ‰ªìÂ∫ì: ${GITEE_REPO}"
          
          # URL ÁºñÁ†Å
          GITEE_REPO_OWNER_ENCODED=$(printf '%s' "${GITEE_REPO_OWNER}" | jq -sRr @uri)
          GITEE_REPO_NAME_ENCODED=$(printf '%s' "${GITEE_REPO_NAME}" | jq -sRr @uri)
          
          # ËØªÂèñ GitHub ÁöÑÊõ¥Êñ∞ÈÖçÁΩÆÊñá‰ª∂
          if [ -f "update_config_github.json" ]; then
            echo "‚úÖ ÊâæÂà∞ GitHub Êõ¥Êñ∞ÈÖçÁΩÆÊñá‰ª∂"
            echo "  Êñá‰ª∂Ë∑ØÂæÑ: $(realpath update_config_github.json 2>/dev/null || echo 'update_config_github.json')"
            
            # ÊòæÁ§∫ÂéüÂßãÈÖçÁΩÆÂÜÖÂÆπ
            echo "  ÂéüÂßãÈÖçÁΩÆÂÜÖÂÆπ:"
            cat update_config_github.json | jq '.' 2>/dev/null || cat update_config_github.json
            
            # ËΩ¨Êç¢‰∏∫ Gitee Ê†ºÂºè
            echo ""
            echo "  ËΩ¨Êç¢ÈÖçÁΩÆ‰∏∫ Gitee Ê†ºÂºè..."
            echo "  Gitee ‰ªìÂ∫ì: ${GITEE_REPO}"
            
            # Âõ∫ÂÆö Release Tag ÂêçÁß∞ÔºàÁÆÄÁü≠ÔºåÊó†ÁâπÊÆäÂ≠óÁ¨¶Ôºâ
            CONFIG_RELEASE_TAG="config"
            CONFIG_RELEASE_TAG_ENCODED=$(printf '%s' "${CONFIG_RELEASE_TAG}" | jq -sRr @uri)
            
            # ‰ΩøÁî® jq ‰øÆÊîπ URLÔºåupdateCheckUrl ÊåáÂêëÂõ∫ÂÆö Release
            cat update_config_github.json | jq "
              .updateCheckUrl = \"https://gitee.com/${GITEE_REPO}/releases/download/${CONFIG_RELEASE_TAG}/update_config_gitee.json\" |
              .client.platforms.macos.downloadUrl = (.client.platforms.macos.downloadUrl | gsub(\"github.com.*releases\"; \"gitee.com/${GITEE_REPO}/releases\")) |
              .client.platforms.windows.downloadUrl = (.client.platforms.windows.downloadUrl | gsub(\"github.com.*releases\"; \"gitee.com/${GITEE_REPO}/releases\")) |
              .server.platforms.android.downloadUrl = (.server.platforms.android.downloadUrl | gsub(\"github.com.*releases\"; \"gitee.com/${GITEE_REPO}/releases\"))
            " > update_config_gitee.json
            
            echo "‚úÖ Â∑≤ÁîüÊàê Gitee Êõ¥Êñ∞ÈÖçÁΩÆÊñá‰ª∂"
            echo "  Êñá‰ª∂Ë∑ØÂæÑ: $(realpath update_config_gitee.json 2>/dev/null || echo 'update_config_gitee.json')"
            echo "  Êõ¥Êñ∞Ê£ÄÊü• URL: https://gitee.com/${GITEE_REPO}/releases/download/${CONFIG_RELEASE_TAG}/update_config_gitee.json"
            echo ""
            echo "  Gitee ÈÖçÁΩÆÂÜÖÂÆπ:"
            cat update_config_gitee.json | jq '.' 2>/dev/null || cat update_config_gitee.json
            
            # Ëé∑Âèñ master ÂàÜÊîØÁöÑÊúÄÊñ∞ commit SHAÔºàÁî®‰∫éÂàõÂª∫/Êõ¥Êñ∞ ReleaseÔºâ
            echo ""
            echo "üîç Ëé∑Âèñ master ÂàÜÊîØÁöÑÊúÄÊñ∞ commit..."
            BRANCH_INFO=$(curl -s -X GET \
              -H "Authorization: token ${GITEE_TOKEN}" \
              "https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/branches/master")
            
            MASTER_COMMIT_SHA=$(echo "$BRANCH_INFO" | jq -r '.commit.sha // empty' 2>/dev/null || echo "")
            
            if [ -z "$MASTER_COMMIT_SHA" ] || [ "$MASTER_COMMIT_SHA" == "null" ]; then
              echo "‚ö†Ô∏è Êó†Ê≥ïËé∑Âèñ master ÂàÜÊîØÁöÑ commit SHAÔºå‰ΩøÁî®ÈªòËÆ§ÂàÜÊîØ"
              MASTER_COMMIT_SHA="master"
            else
              echo "‚úÖ Master ÂàÜÊîØÊúÄÊñ∞ commit: ${MASTER_COMMIT_SHA:0:7}..."
            fi
            
            # Ê£ÄÊü•ÈÖçÁΩÆ Release ÊòØÂê¶Â≠òÂú®
            echo ""
            echo "üîç Ê£ÄÊü•ÈÖçÁΩÆ Release ÊòØÂê¶Â≠òÂú®..."
            RELEASE_CHECK=$(curl -s -w "\n%{http_code}" -X GET \
              -H "Authorization: token ${GITEE_TOKEN}" \
              "https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/releases/tags/${CONFIG_RELEASE_TAG_ENCODED}")
            
            RELEASE_CHECK_HTTP_CODE=$(echo "$RELEASE_CHECK" | tail -n1)
            RELEASE_CHECK_BODY=$(echo "$RELEASE_CHECK" | sed '$d')
            
            echo "  HTTP Áä∂ÊÄÅÁ†Å: ${RELEASE_CHECK_HTTP_CODE}"
            
            if [ "$RELEASE_CHECK_HTTP_CODE" = "200" ]; then
              RELEASE_ID=$(echo "$RELEASE_CHECK_BODY" | jq -r '.id // empty' 2>/dev/null || echo "")
              if [ -n "$RELEASE_ID" ] && [ "$RELEASE_ID" != "null" ]; then
                echo "‚úÖ Release ${CONFIG_RELEASE_TAG} Â∑≤Â≠òÂú® (ID: ${RELEASE_ID})"
                USE_EXISTING_RELEASE=true
              else
                echo "‚ö†Ô∏è Êó†Ê≥ïËé∑Âèñ Release IDÔºåÂ∞ÜÂàõÂª∫Êñ∞ÁöÑ Release"
                USE_EXISTING_RELEASE=false
              fi
            else
              echo "‚ö†Ô∏è Release ${CONFIG_RELEASE_TAG} ‰∏çÂ≠òÂú®ÔºåÂ∞ÜÂàõÂª∫Êñ∞ÁöÑ Release"
              USE_EXISTING_RELEASE=false
            fi
            
            # Á°Æ‰øù tag Â≠òÂú®ÔºàRelease ÈúÄË¶Å tagÔºâ
            echo ""
            echo "üîç Á°Æ‰øù Tag ${CONFIG_RELEASE_TAG} Â≠òÂú®..."
            TAG_CHECK=$(curl -s -w "\n%{http_code}" -X GET \
              -H "Authorization: token ${GITEE_TOKEN}" \
              "https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/tags/${CONFIG_RELEASE_TAG_ENCODED}")
            
            TAG_CHECK_HTTP_CODE=$(echo "$TAG_CHECK" | tail -n1)
            
            if [ "$TAG_CHECK_HTTP_CODE" != "200" ]; then
              echo "  Tag ‰∏çÂ≠òÂú®ÔºåÂàõÂª∫ Tag..."
              CREATE_TAG_BODY=$(echo "{
                \"refs\": \"${MASTER_COMMIT_SHA}\",
                \"tag_name\": \"${CONFIG_RELEASE_TAG}\",
                \"message\": \"Tag for update config release\"
              }" | jq -c .)
              
              CREATE_TAG_RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
                -H "Content-Type: application/json" \
                -H "Authorization: token ${GITEE_TOKEN}" \
                -d "${CREATE_TAG_BODY}" \
                "https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/tags")
              
              CREATE_TAG_HTTP_CODE=$(echo "$CREATE_TAG_RESPONSE" | tail -n1)
              
              if [ "$CREATE_TAG_HTTP_CODE" = "200" ] || [ "$CREATE_TAG_HTTP_CODE" = "201" ]; then
                echo "‚úÖ Tag ${CONFIG_RELEASE_TAG} ÂàõÂª∫ÊàêÂäü"
              else
                ERROR_MSG=$(echo "$CREATE_TAG_RESPONSE" | sed '$d' | jq -r '.message // .error // "Êú™Áü•ÈîôËØØ"' 2>/dev/null || echo "")
                if echo "$ERROR_MSG" | grep -qi "Â∑≤Â≠òÂú®\|already exists\|duplicate\|Ê†áÁ≠æÂêçÂ∑≤Â≠òÂú®"; then
                  echo "‚úÖ Tag Â∑≤Â≠òÂú®"
                else
                  echo "‚ö†Ô∏è Tag ÂàõÂª∫Â§±Ë¥•Ôºå‰ΩÜÁªßÁª≠ÊâßË°å"
                fi
              fi
            else
              echo "‚úÖ Tag ${CONFIG_RELEASE_TAG} Â∑≤Â≠òÂú®"
            fi
            
            # ÂàõÂª∫ÊàñÊõ¥Êñ∞ Release
            echo ""
            if [ "$USE_EXISTING_RELEASE" = false ]; then
              echo "üìù ÂàõÂª∫ÈÖçÁΩÆ Release..."
              
              RELEASE_NAME="Update Configuration"
              RELEASE_BODY="This release contains the update configuration file for the application."
              
              CREATE_RELEASE_BODY=$(echo "{
                \"tag_name\": \"${CONFIG_RELEASE_TAG}\",
                \"name\": \"${RELEASE_NAME}\",
                \"body\": \"${RELEASE_BODY}\",
                \"target_commitish\": \"${MASTER_COMMIT_SHA}\",
                \"prerelease\": false
              }" | jq -c .)
              
              CREATE_RELEASE_RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
                -H "Content-Type: application/json" \
                -H "Authorization: token ${GITEE_TOKEN}" \
                -d "${CREATE_RELEASE_BODY}" \
                "https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/releases")
              
              CREATE_RELEASE_HTTP_CODE=$(echo "$CREATE_RELEASE_RESPONSE" | tail -n1)
              CREATE_RELEASE_BODY_RESPONSE=$(echo "$CREATE_RELEASE_RESPONSE" | sed '$d')
              
              echo "  ÂìçÂ∫î HTTP Áä∂ÊÄÅÁ†Å: ${CREATE_RELEASE_HTTP_CODE}"
              
              if [ "$CREATE_RELEASE_HTTP_CODE" = "200" ] || [ "$CREATE_RELEASE_HTTP_CODE" = "201" ]; then
                RELEASE_ID=$(echo "$CREATE_RELEASE_BODY_RESPONSE" | jq -r '.id // empty' 2>/dev/null || echo "")
                echo "‚úÖ Release ÂàõÂª∫ÊàêÂäü (ID: ${RELEASE_ID})"
              else
                ERROR_MSG=$(echo "$CREATE_RELEASE_BODY_RESPONSE" | jq -r '.message // .error // "Êú™Áü•ÈîôËØØ"' 2>/dev/null || echo "$CREATE_RELEASE_BODY_RESPONSE")
                echo "‚ùå Release ÂàõÂª∫Â§±Ë¥• (HTTP ${CREATE_RELEASE_HTTP_CODE})"
                echo "  ÈîôËØØ‰ø°ÊÅØ: ${ERROR_MSG}"
                exit 1
              fi
            else
              echo "üìù Êõ¥Êñ∞Áé∞Êúâ Release..."
              
              RELEASE_NAME="Update Configuration"
              RELEASE_BODY="This release contains the update configuration file for the application. Updated at $(date -u +'%Y-%m-%d %H:%M:%S')"
              
              UPDATE_RELEASE_BODY=$(echo "{
                \"tag_name\": \"${CONFIG_RELEASE_TAG}\",
                \"name\": \"${RELEASE_NAME}\",
                \"body\": \"${RELEASE_BODY}\",
                \"target_commitish\": \"${MASTER_COMMIT_SHA}\",
                \"prerelease\": false
              }" | jq -c .)
              
              UPDATE_RELEASE_RESPONSE=$(curl -s -w "\n%{http_code}" -X PATCH \
                -H "Content-Type: application/json" \
                -H "Authorization: token ${GITEE_TOKEN}" \
                -d "${UPDATE_RELEASE_BODY}" \
                "https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/releases/${RELEASE_ID}")
              
              UPDATE_RELEASE_HTTP_CODE=$(echo "$UPDATE_RELEASE_RESPONSE" | tail -n1)
              
              echo "  ÂìçÂ∫î HTTP Áä∂ÊÄÅÁ†Å: ${UPDATE_RELEASE_HTTP_CODE}"
              
              if [ "$UPDATE_RELEASE_HTTP_CODE" = "200" ] || [ "$UPDATE_RELEASE_HTTP_CODE" = "201" ]; then
                echo "‚úÖ Release Êõ¥Êñ∞ÊàêÂäü"
              else
                ERROR_MSG=$(echo "$UPDATE_RELEASE_RESPONSE" | sed '$d' | jq -r '.message // .error // "Êú™Áü•ÈîôËØØ"' 2>/dev/null || echo "")
                echo "‚ö†Ô∏è Release Êõ¥Êñ∞Â§±Ë¥• (HTTP ${UPDATE_RELEASE_HTTP_CODE})Ôºå‰ΩÜÁªßÁª≠ÊâßË°å"
                echo "  ÈîôËØØ‰ø°ÊÅØ: ${ERROR_MSG}"
              fi
            fi
            
            # ‰∏ä‰º†ÈÖçÁΩÆÊñá‰ª∂Âà∞ Release
            echo ""
            echo "üì§ ‰∏ä‰º†ÈÖçÁΩÆÊñá‰ª∂Âà∞ Release..."
            
            # Ê£ÄÊü•Êñá‰ª∂ÊòØÂê¶Â∑≤Â≠òÂú®
            ASSETS_CHECK=$(curl -s -X GET \
              -H "Authorization: token ${GITEE_TOKEN}" \
              "https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/releases/${RELEASE_ID}/attach_files")
            
            EXISTING_ASSET_ID=$(echo "$ASSETS_CHECK" | jq -r ".[] | select(.name == \"update_config_gitee.json\") | .id" 2>/dev/null | head -1)
            
            if [ -n "$EXISTING_ASSET_ID" ] && [ "$EXISTING_ASSET_ID" != "null" ]; then
              echo "  Êñá‰ª∂Â∑≤Â≠òÂú® (ID: ${EXISTING_ASSET_ID})ÔºåÂà†Èô§ÊóßÊñá‰ª∂..."
              DELETE_ASSET_RESPONSE=$(curl -s -w "\n%{http_code}" -X DELETE \
                -H "Authorization: token ${GITEE_TOKEN}" \
                "https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/releases/${RELEASE_ID}/attach_files/${EXISTING_ASSET_ID}")
              
              DELETE_ASSET_HTTP_CODE=$(echo "$DELETE_ASSET_RESPONSE" | tail -n1)
              echo "  Âà†Èô§ÂìçÂ∫î HTTP Áä∂ÊÄÅÁ†Å: ${DELETE_ASSET_HTTP_CODE}"
              sleep 2
            fi
            
            echo "  ‰∏ä‰º†Êñ∞Êñá‰ª∂..."
            UPLOAD_API_URL="https://gitee.com/api/v5/repos/${GITEE_REPO_OWNER_ENCODED}/${GITEE_REPO_NAME_ENCODED}/releases/${RELEASE_ID}/attach_files"
            
            FILE_SIZE=$(stat -f%z update_config_gitee.json 2>/dev/null || stat -c%s update_config_gitee.json 2>/dev/null || echo "unknown")
            echo "  Êñá‰ª∂Â§ßÂ∞è: ${FILE_SIZE} bytes"
            
            UPLOAD_RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
              -H "Authorization: token ${GITEE_TOKEN}" \
              -F "file=@update_config_gitee.json" \
              -F "name=update_config_gitee.json" \
              "${UPLOAD_API_URL}")
            
            UPLOAD_HTTP_CODE=$(echo "$UPLOAD_RESPONSE" | tail -n1)
            UPLOAD_BODY_RESPONSE=$(echo "$UPLOAD_RESPONSE" | sed '$d')
            
            echo "  ÂìçÂ∫î HTTP Áä∂ÊÄÅÁ†Å: ${UPLOAD_HTTP_CODE}"
            
            if [ "$UPLOAD_HTTP_CODE" = "200" ] || [ "$UPLOAD_HTTP_CODE" = "201" ]; then
              ASSET_NAME=$(echo "$UPLOAD_BODY_RESPONSE" | jq -r '.name // empty' 2>/dev/null || echo "")
              ASSET_URL=$(echo "$UPLOAD_BODY_RESPONSE" | jq -r '.browser_download_url // empty' 2>/dev/null || echo "")
              echo "‚úÖ Êñá‰ª∂‰∏ä‰º†ÊàêÂäü"
              if [ -n "$ASSET_NAME" ]; then
                echo "  Êñá‰ª∂Âêç: ${ASSET_NAME}"
              fi
              if [ -n "$ASSET_URL" ]; then
                echo "  ‰∏ãËΩΩ URL: ${ASSET_URL}"
              fi
            else
              ERROR_MSG=$(echo "$UPLOAD_BODY_RESPONSE" | jq -r '.message // .error // "Êú™Áü•ÈîôËØØ"' 2>/dev/null || echo "$UPLOAD_BODY_RESPONSE")
              echo "‚ùå Êñá‰ª∂‰∏ä‰º†Â§±Ë¥• (HTTP ${UPLOAD_HTTP_CODE})"
              echo "  ÈîôËØØ‰ø°ÊÅØ: ${ERROR_MSG}"
              echo "  ÂÆåÊï¥ÂìçÂ∫î: ${UPLOAD_BODY_RESPONSE}"
              exit 1
            fi
            
            echo ""
            echo "‚úÖ Êõ¥Êñ∞ÈÖçÁΩÆÊñá‰ª∂Â∑≤ÊàêÂäüÂêåÊ≠•Âà∞ Gitee Release: ${CONFIG_RELEASE_TAG}"
            echo "  ËÆøÈóÆ URL: https://gitee.com/${GITEE_REPO}/releases/download/${CONFIG_RELEASE_TAG}/update_config_gitee.json"
          else
            echo "‚ö†Ô∏è update_config_github.json Êú™ÊâæÂà∞ÔºåË∑≥ËøáÈÖçÁΩÆÂêåÊ≠•"
            echo "  ÂΩìÂâçÁõÆÂΩï: $(pwd)"
            echo "  Êñá‰ª∂ÂàóË°®:"
            ls -la *.json 2>/dev/null || echo "  Êú™ÊâæÂà∞ JSON Êñá‰ª∂"
            exit 1
          fi

